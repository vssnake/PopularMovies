package com.virtu.popularmovies.data.entity.mapper;

import com.virtu.popularmovies.data.entity.MovieEntity;

import org.json.JSONException;
import org.junit.Before;
import org.junit.Rule;
import org.junit.Test;
import org.junit.rules.ExpectedException;

import java.util.Collection;

import static org.hamcrest.MatcherAssert.assertThat;
import static org.hamcrest.core.Is.is;

/**
 * Created by unai on 21/08/15.
 */
public class MovieEntityJsonMapperTest {

    private static final String JSON_RESPONSE_MOVIES_COLLECTION = "{\"page\":1,\"results\":[{\"adult\":false,\"backdrop_path\":\"/hbn46fQaRmlpBuUrEiFqv0GDL6Y.jpg\",\"genre_ids\":[878,28,12],\"id\":24428,\"original_language\":\"en\",\"original_title\":\"The Avengers\",\"overview\":\"When an unexpected enemy emerges and threatens global safety and security, Nick Fury, director of the international peacekeeping agency known as S.H.I.E.L.D., finds himself in need of a team to pull the world back from the brink of disaster. Spanning the globe, a daring recruitment effort begins!\",\"release_date\":\"2012-05-04\",\"poster_path\":\"/cezWGskPY5x7GaglTTRN4Fugfb8.jpg\",\"popularity\":8.194242,\"title\":\"The Avengers\",\"video\":false,\"vote_average\":7.2,\"vote_count\":7245},{\"adult\":false,\"backdrop_path\":\"/s2bT29y0ngXxxu2IA8AOzzXTRhd.jpg\",\"genre_ids\":[28,53,878,9648,12],\"id\":27205,\"original_language\":\"en\",\"original_title\":\"Inception\",\"overview\":\"Cobb, a skilled thief who commits corporate espionage by infiltrating the subconscious of his targets is offered a chance to regain his old life as payment for a task considered to be impossible: \\\"inception\\\", the implantation of another person's idea into a target's subconscious.\",\"release_date\":\"2010-07-16\",\"poster_path\":\"/qmDpIHrmpJINaRKAfWQfftjCdyi.jpg\",\"popularity\":7.43092,\"title\":\"Inception\",\"video\":false,\"vote_average\":7.7,\"vote_count\":7128},{\"adult\":false,\"backdrop_path\":\"/5XPPB44RQGfkBrbJxmtdndKz05n.jpg\",\"genre_ids\":[28,12,14,878],\"id\":19995,\"original_language\":\"en\",\"original_title\":\"Avatar\",\"overview\":\"In the 22nd century, a paraplegic Marine is dispatched to the moon Pandora on a unique mission, but becomes torn between following orders and protecting an alien civilization.\",\"release_date\":\"2009-12-18\",\"poster_path\":\"/tcqb9NHdw9SWs2a88KCDD4V8sVR.jpg\",\"popularity\":4.329567,\"title\":\"Avatar\",\"video\":false,\"vote_average\":7,\"vote_count\":6668},{\"adult\":false,\"backdrop_path\":\"/nnMC0BM6XbjIIrT4miYmMtPGcQV.jpg\",\"genre_ids\":[18,28,80,53],\"id\":155,\"original_language\":\"en\",\"original_title\":\"The Dark Knight\",\"overview\":\"Batman raises the stakes in his war on crime. With the help of Lt. Jim Gordon and District Attorney Harvey Dent, Batman sets out to dismantle the remaining criminal organizations that plague the streets. The partnership proves to be effective, but they soon find themselves prey to a reign of chaos unleashed by a rising criminal mastermind known to the terrified citizens of Gotham as the Joker.\",\"release_date\":\"2008-07-18\",\"poster_path\":\"/1hRoyzDtpgMU7Dz4JF22RANzQO7.jpg\",\"popularity\":5.373156,\"title\":\"The Dark Knight\",\"video\":false,\"vote_average\":7.9,\"vote_count\":5907},{\"adult\":false,\"backdrop_path\":\"/n9X2DKItL3V0yq1q1jrk8z5UAki.jpg\",\"genre_ids\":[28,12,878],\"id\":68721,\"original_language\":\"en\",\"original_title\":\"Iron Man 3\",\"overview\":\"The brash-but-brilliant industrialist Tony Stark faces an enemy whose reach knows no bounds. When Stark finds his personal world destroyed at his enemy’s hands, he embarks on a harrowing quest to find those responsible. This journey, at every turn, will test his mettle. With his back against the wall, Stark is left to survive by his own devices, relying on his ingenuity and instincts to protect those closest to him. As he fights his way back, Stark discovers the answer to the question that has secretly haunted him: does the man make the suit or does the suit make the man?\",\"release_date\":\"2013-05-03\",\"poster_path\":\"/1Ilv6ryHUv6rt9zIsbSEJUmmbEi.jpg\",\"popularity\":6.154807,\"title\":\"Iron Man 3\",\"video\":false,\"vote_average\":6.8,\"vote_count\":5682},{\"adult\":false,\"backdrop_path\":\"/sVv4VXJ7Vd9qDPncs0zu2XepWQr.jpg\",\"genre_ids\":[12,14,878],\"id\":70160,\"original_language\":\"en\",\"original_title\":\"The Hunger Games\",\"overview\":\"Every year in the ruins of what was once North America, the nation of Panem forces each of its twelve districts to send a teenage boy and girl to compete in the Hunger Games. Part twisted entertainment, part government intimidation tactic, the Hunger Games are a nationally televised event in which “Tributes” must fight with one another until one survivor remains. Pitted against highly-trained Tributes who have prepared for these Games their entire lives, Katniss is forced to rely upon her sharp instincts as well as the mentorship of drunken former victor Haymitch Abernathy. If she’s ever to return home to District 12, Katniss must make impossible choices in the arena that weigh survival against humanity and life against love. The world will be watching.\",\"release_date\":\"2012-03-23\",\"poster_path\":\"/vAkjFEm76Lu5hSevquxPgQ91OtI.jpg\",\"popularity\":2.220968,\"title\":\"The Hunger Games\",\"video\":false,\"vote_average\":6.6,\"vote_count\":5581},{\"adult\":false,\"backdrop_path\":\"/kFwUy1Nu9tM4ywZAGXHoetBY2pk.jpg\",\"genre_ids\":[18,37],\"id\":68718,\"original_language\":\"en\",\"original_title\":\"Django Unchained\",\"overview\":\"With the help of a German bounty hunter, a freed slave sets out to rescue his wife from a brutal Mississippi plantation owner.\",\"release_date\":\"2012-12-25\",\"poster_path\":\"/5WJnxuw41sddupf8cwOxYftuvJG.jpg\",\"popularity\":5.147236,\"title\":\"Django Unchained\",\"video\":false,\"vote_average\":7.5,\"vote_count\":5470},{\"adult\":false,\"backdrop_path\":\"/jjAq3tCezdlQduusgtMhpY2XzW0.jpg\",\"genre_ids\":[28,12,14],\"id\":49051,\"original_language\":\"en\",\"original_title\":\"The Hobbit: An Unexpected Journey\",\"overview\":\"Bilbo Baggins, a hobbit enjoying his quiet life, is swept into an epic quest by Gandalf the Grey and thirteen dwarves who seek to reclaim their mountain home from Smaug, the dragon.\",\"release_date\":\"2012-12-14\",\"poster_path\":\"/h1XjBJoWdOh8aegBoVYKgABQZSL.jpg\",\"popularity\":4.827213,\"title\":\"The Hobbit: An Unexpected Journey\",\"video\":false,\"vote_average\":6.8,\"vote_count\":5315},{\"adult\":false,\"backdrop_path\":\"/3bgtUfKQKNi3nJsAB5URpP2wdRt.jpg\",\"genre_ids\":[28,80,18,53],\"id\":49026,\"original_language\":\"en\",\"original_title\":\"The Dark Knight Rises\",\"overview\":\"Following the death of District Attorney Harvey Dent, Batman assumes responsibility for Dent's crimes to protect the late attorney's reputation and is subsequently hunted by the Gotham City Police Department. Eight years later, Batman encounters the mysterious Selina Kyle and the villainous Bane, a new terrorist leader who overwhelms Gotham's finest. The Dark Knight resurfaces to protect a city that has branded him an enemy.\",\"release_date\":\"2012-07-20\",\"poster_path\":\"/dEYnvnUfXrqvqeRSqvIEtmzhoA8.jpg\",\"popularity\":6.387706,\"title\":\"The Dark Knight Rises\",\"video\":false,\"vote_average\":7.4,\"vote_count\":5285},{\"adult\":false,\"backdrop_path\":\"/dpo7WDOhWtACY6oflrqxutbhg81.jpg\",\"genre_ids\":[28,12,53],\"id\":37724,\"original_language\":\"en\",\"original_title\":\"Skyfall\",\"overview\":\"When Bond's latest assignment goes gravely wrong and agents around the world are exposed, MI6 is attacked forcing M to relocate the agency. These events cause her authority and position to be challenged by Gareth Mallory (Ralph Fiennes), the new Chairman of the Intelligence and Security Committee. With MI6 now compromised from both inside and out, M is left with one ally she can trust: Bond. 007 takes to the shadows - aided only by field agent, Eve (Naomie Harris) - following a trail to the mysterious Silva (Javier Bardem), whose lethal and hidden motives have yet to reveal themselves.\",\"release_date\":\"2012-11-09\",\"poster_path\":\"/uVALAeLEMGMf3oYpvdVi4uuaNOo.jpg\",\"popularity\":4.634234,\"title\":\"Skyfall\",\"video\":false,\"vote_average\":6.7,\"vote_count\":4742},{\"adult\":false,\"backdrop_path\":\"/ZQixhAZx6fH1VNafFXsqa1B8QI.jpg\",\"genre_ids\":[28,878,12],\"id\":1726,\"original_language\":\"en\",\"original_title\":\"Iron Man\",\"overview\":\"Tony Stark. Genius, billionaire, playboy, philanthropist. Son of legendary inventor and weapons contractor Howard Stark. When Tony Stark is assigned to give a weapons presentation to an Iraqi unit led by Lt. Col. James Rhodes, he's given a ride on enemy lines. That ride ends badly when Stark's Humvee that he's riding in is attacked by enemy combatants. He survives - barely - with a chest full of shrapnel and a car battery attached to his heart. In order to survive he comes up with a way to miniaturize the battery and figures out that the battery can power something else. Thus Iron Man is born. He uses the primitive device to escape from the cave in Iraq. Once back home, he then begins work on perfecting the Iron Man suit. But the man who was put in charge of Stark Industries has plans of his own to take over Tony's technology for other matters.\",\"release_date\":\"2008-05-02\",\"poster_path\":\"/848chlIWVT41VtAAgyh9bWymAYb.jpg\",\"popularity\":5.524613,\"title\":\"Iron Man\",\"video\":false,\"vote_average\":7.1,\"vote_count\":4596},{\"adult\":false,\"backdrop_path\":\"/7u3pxc0K1wx32IleAkLv78MKgrw.jpg\",\"genre_ids\":[12,28,53,878],\"id\":603,\"original_language\":\"en\",\"original_title\":\"The Matrix\",\"overview\":\"Thomas A. Anderson is a man living two lives. By day he is an average computer programmer and by night a malevolent hacker known as Neo, who finds himself targeted by the police when he is contacted by Morpheus, a legendary computer hacker, who reveals the shocking truth about our reality.\",\"release_date\":\"1999-03-30\",\"poster_path\":\"/gynBNzwyaHKtXqlEKKLioNkjKgN.jpg\",\"popularity\":4.980718,\"title\":\"The Matrix\",\"video\":false,\"vote_average\":7.6,\"vote_count\":4499},{\"adult\":false,\"backdrop_path\":\"/pIUvQ9Ed35wlWhY2oU6OmwEsmzG.jpg\",\"genre_ids\":[12,14,28],\"id\":120,\"original_language\":\"en\",\"original_title\":\"The Lord of the Rings: The Fellowship of the Ring\",\"overview\":\"Young hobbit Frodo Baggins, after inheriting a mysterious ring from his uncle Bilbo, must leave his home in order to keep it from falling into the hands of its evil creator. Along the way, a fellowship is formed to protect the ringbearer and make sure that the ring arrives at its final destination: Mt. Doom, the only place where it can be destroyed.\",\"release_date\":\"2001-12-19\",\"poster_path\":\"/9HG6pINW1KoFTAKY3LdybkoOKAm.jpg\",\"popularity\":4.717782,\"title\":\"The Lord of the Rings: The Fellowship of the Ring\",\"video\":false,\"vote_average\":7.6,\"vote_count\":4344},{\"adult\":false,\"backdrop_path\":\"/8BPZO0Bf8TeAy8znF43z8soK3ys.jpg\",\"genre_ids\":[12,14,28],\"id\":122,\"original_language\":\"en\",\"original_title\":\"The Lord of the Rings: The Return of the King\",\"overview\":\"Aragorn is revealed as the heir to the ancient kings as he, Gandalf and the other members of the broken fellowship struggle to save Gondor from Sauron's forces. Meanwhile, Frodo and Sam bring the ring closer to the heart of Mordor, the dark lord's realm.\",\"release_date\":\"2003-12-01\",\"poster_path\":\"/50LoR9gJhbWZ5PpoHgi8MNTYgzd.jpg\",\"popularity\":4.865146,\"title\":\"The Lord of the Rings: The Return of the King\",\"video\":false,\"vote_average\":7.7,\"vote_count\":4107},{\"adult\":false,\"backdrop_path\":\"/xBKGJQsAIeweesB79KC89FpBrVr.jpg\",\"genre_ids\":[18,80],\"id\":278,\"original_language\":\"en\",\"original_title\":\"The Shawshank Redemption\",\"overview\":\"Framed in the 1940s for the double murder of his wife and her lover, upstanding banker Andy Dufresne begins a new life at the Shawshank prison, where he puts his accounting skills to work for an amoral warden. During his long stretch in prison, Dufresne comes to be admired by the other inmates -- including an older prisoner named Red -- for his integrity and unquenchable sense of hope.\",\"release_date\":\"1994-09-14\",\"poster_path\":\"/9O7gLzmreU0nGkIB6K3BsJbzvNv.jpg\",\"popularity\":4.907481,\"title\":\"The Shawshank Redemption\",\"video\":false,\"vote_average\":8.2,\"vote_count\":4012},{\"adult\":false,\"backdrop_path\":\"/yo1ef57MEPkEE4BDZKTZGH9uDcX.jpg\",\"genre_ids\":[16,10751],\"id\":20352,\"original_language\":\"en\",\"original_title\":\"Despicable Me\",\"overview\":\"In a happy suburban neighbourhood surrounded by white picket fences with flowering rose bushes, sits a black house with a dead lawn. Unbeknownst to the neighbours, hidden deep beneath this home is a vast secret hideout. Surrounded by an army of tireless, little yellow minions, we discover Gru, planning the biggest heist in the history of the world. He is going to steal the moon (Yes, the moon!) to prove to his Mum that he is better than the other super-villains, especially the new kid on the block, Vector. Gru delights in all things wicked. Armed with his arsenal of shrink rays, freeze guns and battle-ready vehicles for land and air, he vanquishes all who stand in his way. Until the day he encounters the immense will of three little orphaned girls who look at him and see something that no one else has ever seen: a potential dad.\",\"release_date\":\"2010-07-09\",\"poster_path\":\"/4zHJhBSY4kNZXfhTlmy2TzXD51M.jpg\",\"popularity\":2.794251,\"title\":\"Despicable Me\",\"video\":false,\"vote_average\":7,\"vote_count\":3963},{\"adult\":false,\"backdrop_path\":\"/qjfE7SkPXpqFs8FX8rIaG6eO2aK.jpg\",\"genre_ids\":[28,53,80],\"id\":82992,\"original_language\":\"en\",\"original_title\":\"Fast & Furious 6\",\"overview\":\"Hobbs has Dominic and Brian reassemble their crew to take down a team of mercenaries: Dominic unexpectedly gets convoluted also facing his presumed deceased girlfriend, Letty.\",\"release_date\":\"2013-05-24\",\"poster_path\":\"/b9gTJKLdSbwcQRKzmqMq3dMfRwI.jpg\",\"popularity\":1.257552,\"title\":\"Fast & Furious 6\",\"video\":false,\"vote_average\":6.6,\"vote_count\":3805},{\"adult\":false,\"backdrop_path\":\"/4Dd0CcqIHeyJFALYVzpHrsnbOX6.jpg\",\"genre_ids\":[28,12,14],\"id\":1930,\"original_language\":\"en\",\"original_title\":\"The Amazing Spider-Man\",\"overview\":\"Peter Parker is an outcast high schooler was abandoned by his parents as a boy, leaving him to be raised by his Uncle Ben and Aunt May. Like most teenagers, Peter is trying to figure out who he is and how he got to be the person he is today. As Peter discovers a mysterious briefcase that belonged to his father, he begins a quest to understand his parents' disappearance—leading him directly to Oscorp and the lab of Dr. Curt Connors, his father's former partner. As Spider-Man is set on a collision course with Connors' alter ego, The Lizard, Peter will make life-altering choices to use his powers and shape his destiny to become a hero.\",\"release_date\":\"2012-07-04\",\"poster_path\":\"/AtFhFTNbNo49qn7fkbo9lDtRkeR.jpg\",\"popularity\":4.559887,\"title\":\"The Amazing Spider-Man\",\"video\":false,\"vote_average\":6.3,\"vote_count\":3800},{\"adult\":false,\"backdrop_path\":\"/jxdSxqAFrdioKgXwgTs5Qfbazjq.jpg\",\"genre_ids\":[28,12,878],\"id\":10138,\"original_language\":\"en\",\"original_title\":\"Iron Man 2\",\"overview\":\"With the world now aware of his dual life as the armored superhero Iron Man, billionaire inventor Tony Stark faces pressure from the government, the press, and the public to share his technology with the military. Unwilling to let go of his invention, Stark, along with Pepper Potts, and James \\\"Rhodey\\\" Rhodes at his side, must forge new alliances - and confront powerful enemies.\",\"release_date\":\"2010-05-07\",\"poster_path\":\"/ArqpkNYGfcTIA6umWt6xihfIZZv.jpg\",\"popularity\":4.326624,\"title\":\"Iron Man 2\",\"video\":false,\"vote_average\":6.6,\"vote_count\":3795},{\"adult\":false,\"backdrop_path\":\"/8uO0gUM8aNqYLs1OsTBQiXu0fEv.jpg\",\"genre_ids\":[18],\"id\":550,\"original_language\":\"en\",\"original_title\":\"Fight Club\",\"overview\":\"A ticking-time-bomb insomniac and a slippery soap salesman channel primal male aggression into a shocking new form of therapy. Their concept catches on, with underground \\\"fight clubs\\\" forming in every town, until an eccentric gets in the way and ignites an out-of-control spiral toward oblivion.\",\"release_date\":\"1999-10-14\",\"poster_path\":\"/811DjJTon9gD6hZ8nCjSitaIXFQ.jpg\",\"popularity\":3.530514,\"title\":\"Fight Club\",\"video\":false,\"vote_average\":7.9,\"vote_count\":3721}],\"total_pages\":11968,\"total_results\":239344}";

    private MovieEntityJsonMapper movieEntityJsonMapper;

    @Rule
    public ExpectedException expectedException = ExpectedException.none();

    @Before
    public void setUp() {
        movieEntityJsonMapper = new MovieEntityJsonMapper();
    }

    @Test
    public void testTransformMovieEntityCollectionHappyCase() throws JSONException {
        Collection<MovieEntity> movieEntityCollection=
                movieEntityJsonMapper.transformMovieEntityCollection(
                        JSON_RESPONSE_MOVIES_COLLECTION);

        assertThat(((MovieEntity)movieEntityCollection.toArray()[0]).getId(),is(24428L));
        assertThat(((MovieEntity)movieEntityCollection.toArray()[0]).getId(),is(27205L));
        assertThat(movieEntityCollection.size(), is(20));

    }
}
